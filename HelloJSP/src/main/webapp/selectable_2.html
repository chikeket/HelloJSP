<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<script src='js/index.global.js'></script>
<script>

  document.addEventListener('DOMContentLoaded', async function() {
	  //값을 담을 변수 선언
	  let eventList = [
		//{title:"test", start:"2023-01-04"}  
	  ];
	  //ajax 실행. 비동기방식이라는걸 인지해야됨.
	  //promise 객체를 반환하는 녀석만 await를 쓸수있음
	  let result = await fetch('calenderList.do')
	  let data = await result.json(); // promise반환해줌
	  eventList = data;		  
	  
    var calendarEl = document.getElementById('calendar');

    var calendar = new FullCalendar.Calendar(calendarEl, { //오브젝트타입의 객체
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      initialDate: '2025-09-12',
      navLinks: true, // can click day/week names to navigate views
      selectable: true,
      selectMirror: true,
      select: async function(arg) {
        var title = prompt('일정을 등록하세요!:');
        if (title) {
        	console.dir(title);
        	console.dir(arg);
        	let resolve = await fetch("addCalendar.do?title=" + title + '&start=' + arg.startStr + '&end=' + arg.endStr)
        	let result = await resolve.json();
        	if(result.retCode == 'OK') {
		          calendar.addEvent({
		            title: title,
		            start: arg.start,
		            end: arg.end,
		            allDay: arg.allDay
		            })					
				} else if(result.retCode == 'NG') {
					alert("에러 발생");
				} else {
					alert("알수없는 예외");
				}
			
        }// end of if.
        calendar.unselect()
      },
      eventClick: async function(arg) {
        if (confirm('일정을 삭제하겠습니까?')) {
        	console.dir(arg);   	
        	//날짜변환 완료
        	let resolve = await fetch("removeCalender.do?title=" + arg.event.title + '&start=' + arg.event.startStr + '&end=' + arg.event.endStr)
        	let result = await resolve.json();
        	console.log(result);				
			console.log(eventList);	
			console.log("아마도 처리됬을거임");				
			if(result.retCode == 'OK') {
                    arg.event.remove()			          					
				} else if(result.retCode == 'NG') {
					alert("에러 발생");
				} else {
					alert("알수없는 예외");
				}			
        }// end of if.
      },
      editable: true,
      dayMaxEvents: true, // allow "more" link when too many events
      events: eventList //배열이 있는위치      
    });

    calendar.render();
	  }); // end of DOMContentLoaded.
</script>
<style>

  body {
    margin: 40px 10px;
    padding: 0;
    font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
    font-size: 14px;
  }

  #calendar {
    max-width: 1100px;
    margin: 0 auto;
  }

</style>
</head>
<body>

  <div id='calendar'></div>
  
</body>
</html>
